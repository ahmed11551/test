# Решение проблем (Troubleshooting)

## Ошибка 404 NOT_FOUND

Если вы получаете ошибку `404 NOT_FOUND` с идентификатором типа `arn1::lw6zl-...`, это может быть связано с несколькими причинами:

### 1. Проблема с API (бекенд не найден)

**Симптомы:**
- Ошибка 404 при попытке загрузить или отправить сообщение
- В консоли браузера видна ошибка подключения к API

**Решение:**

1. **Проверьте, что бекенд запущен:**
   ```bash
   # Откройте URL бекенда в браузере
   # Должен вернуться JSON: {"status": "ok", "message": "Chat API is running"}
   ```

2. **Проверьте переменную окружения `VITE_API_URL`:**
   - На Vercel: Settings → Environment Variables → `VITE_API_URL`
   - На Netlify: Site settings → Environment variables → `VITE_API_URL`
   - Убедитесь, что URL указан правильно (без слеша в конце)
   - Пример: `https://your-backend.railway.app` (не `https://your-backend.railway.app/`)

3. **Проверьте доступность бекенда:**
   ```bash
   # Проверьте health endpoint
   curl https://your-backend-url.com/health
   
   # Должен вернуться: {"status": "ok", "service": "Chat API"}
   ```

4. **Проверьте CORS настройки:**
   - Убедитесь, что в `backend/main.py` CORS настроен правильно
   - Для разработки можно использовать `allow_origins=["*"]`
   - Для продакшена лучше указать конкретный домен фронтенда

### 2. Проблема с фронтендом (SPA routing)

**Симптомы:**
- Ошибка 404 при прямом переходе по URL
- Ошибка 404 при обновлении страницы
- Страница не загружается

**Решение:**

1. **Vercel:**
   - Убедитесь, что файл `frontend/vercel.json` содержит rewrites:
   ```json
   {
     "rewrites": [
       {
         "source": "/(.*)",
         "destination": "/index.html"
       }
     ]
   }
   ```

2. **Netlify:**
   - Убедитесь, что файл `frontend/public/_redirects` существует и содержит:
   ```
   /*    /index.html   200
   ```

3. **Передеплойте фронтенд** после изменения конфигурации

### 3. Проблема с деплоем бекенда

**Симптомы:**
- Бекенд не отвечает на запросы
- Ошибка подключения при попытке обратиться к API

**Решение:**

1. **Railway:**
   - Проверьте логи деплоя в Railway Dashboard
   - Убедитесь, что start command правильный: `uvicorn main:app --host 0.0.0.0 --port $PORT`
   - Проверьте, что все зависимости установлены

2. **Render:**
   - Проверьте логи в Render Dashboard
   - Убедитесь, что Build Command: `pip install -r requirements.txt`
   - Убедитесь, что Start Command: `uvicorn main:app --host 0.0.0.0 --port $PORT`

## Диагностика

### Шаг 1: Проверка бекенда

Откройте в браузере:
- `https://your-backend-url.com/` - должен вернуть `{"status": "ok", "message": "Chat API is running"}`
- `https://your-backend-url.com/health` - должен вернуть `{"status": "ok", "service": "Chat API"}`
- `https://your-backend-url.com/docs` - должна открыться документация FastAPI

### Шаг 2: Проверка фронтенда

1. Откройте консоль браузера (F12)
2. Проверьте, какой URL используется для API запросов
3. Проверьте ошибки в консоли

### Шаг 3: Проверка переменных окружения

**На фронтенде:**
```bash
# В консоли браузера после загрузки страницы
console.log(import.meta.env.VITE_API_URL)
```

Должен показать URL вашего бекенда.

**На бекенде:**
```bash
# В логах деплоя проверьте переменные окружения
# ALLOWED_ORIGINS должна быть установлена (или оставлена по умолчанию "*")
```

## Частые ошибки

### Ошибка: "Cannot connect to API"

**Причина:** Бекенд недоступен или URL указан неправильно

**Решение:**
1. Проверьте, что бекенд запущен
2. Проверьте переменную `VITE_API_URL`
3. Убедитесь, что нет проблем с CORS

### Ошибка: "Failed to fetch messages (404 NOT_FOUND)"

**Причина:** Эндпоинт `/messages` не найден

**Решение:**
1. Проверьте, что бекенд запущен и доступен
2. Проверьте URL бекенда в переменной `VITE_API_URL`
3. Убедитесь, что путь к API правильный (без лишних слешей)

### Ошибка: CORS policy

**Причина:** Бекенд не разрешает запросы с фронтенда

**Решение:**
1. Обновите `ALLOWED_ORIGINS` в настройках бекенда
2. Или временно используйте `allow_origins=["*"]` для тестирования

## Локальная проверка

Перед деплоем всегда проверяйте локально:

```bash
# Терминал 1: Бекенд
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload --port 8000

# Терминал 2: Фронтенд
cd frontend
npm install
npm run dev
```

Затем откройте http://localhost:3000 и проверьте работу.

## Получение помощи

Если проблема не решается:

1. Проверьте логи деплоя на платформе (Vercel/Netlify/Railway/Render)
2. Проверьте консоль браузера на наличие ошибок
3. Проверьте Network tab в DevTools браузера для просмотра запросов
4. Убедитесь, что все переменные окружения установлены правильно

